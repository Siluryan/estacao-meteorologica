{% extends 'base.html' %}
{% load static %}

{% block extra_css %}
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
<link rel="stylesheet" href="{% static 'sensores/css/dashboard.css' %}">
{% endblock %}

{% block content %}
<div class="dashboard-header">
    <div>
        <h2><i class="fas fa-chart-line"></i> Dados em Tempo Real</h2>
        <p class="text-muted" style="margin: 0.5rem 0 0 0;">
            <i class="fas fa-clock"></i> 
            Última atualização: <span id="data_hora" style="font-weight: 600;">--</span>
        </p>
    </div>
    <div class="ws-status-container">
        <span style="font-size: 0.875rem; color: var(--text-secondary);">Status:</span>
        <span id="ws_status" class="badge bg-secondary">Aguardando</span>
    </div>
</div>

<div class="section-header">
    <h3>Localização</h3>
</div>
<p class="section-description">Dados de posicionamento GPS da estação meteorológica</p>
<div class="dashboard-cards">
        <div class="card-container">
            <div class="card">
                <div class="card-body">
                    <div class="sensor-data">
                        <div>
                            <h5 class="card-title">Coordenadas</h5>
                            <p class="card-text" id="coordenadas">--</p>
                            <small class="text-muted" id="local">Aguardando localização...</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-container">
            <div class="card">
                <div class="card-body">
                    <div id="map"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-cards">
        <div class="card-container">
            <div class="card">
                <div class="card-body">
                    <div class="sensor-data">
                        <div>
                            <h5 class="card-title">Temperatura</h5>
                            <p class="card-text h4"><span id="temperatura">--</span>°C</p>
                        </div>
                        <div class="chart-mini">
                            <canvas id="tempChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-container">
            <div class="card">
                <div class="card-body">
                    <div class="sensor-data">
                        <div>
                            <h5 class="card-title">Umidade</h5>
                            <p class="card-text h4"><span id="umidade">--</span>%</p>
                        </div>
                        <div class="chart-mini">
                            <canvas id="umidChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-container">
            <div class="card">
                <div class="card-body">
                    <div class="sensor-data">
                        <div>
                            <h5 class="card-title">Luminosidade <span id="lux_icon"></span></h5>
                            <p class="card-text h4"><span id="luminosidade">--</span> lux</p>
                        </div>
                        <div class="chart-mini">
                            <canvas id="luxChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-container">
            <div class="card">
                <div class="card-body">
                    <div class="sensor-data">
                        <div>
                            <h5 class="card-title">Chuva</h5>
                            <p class="card-text h4"><span id="chuva">--</span></p>
                            <small class="text-muted">Detecção de precipitação</small>
                        </div>
                        <div class="status-indicator">
                            <div id="chuva_indicator" class="indicator"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
<div class="section-header">
    <h3>Qualidade do Ar (PMS3003)</h3>
</div>
<p class="section-description">Monitoramento de partículas suspensas no ar - valores em µg/m³</p>
<div class="dashboard-cards">
        <div class="card-container">
            <div class="card">
                <div class="card-body">
                    <div class="sensor-data">
                        <div>
                            <h5 class="card-title">PM1.0</h5>
                            <p class="card-text h4"><span id="pm1_0">--</span> µg/m³</p>
                            <small class="text-muted" id="pm1_status">Partículas ultrafinas</small>
                        </div>
                        <div class="quality-indicator">
                            <div id="pm1_quality" class="quality-badge">--</div>
                        </div>
                        <div class="chart-mini" style="display: none;">
                            <canvas id="pm1Chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-container">
            <div class="card">
                <div class="card-body">
                    <div class="sensor-data">
                        <div>
                            <h5 class="card-title">PM2.5</h5>
                            <p class="card-text h4"><span id="pm2_5">--</span> µg/m³</p>
                            <small class="text-muted" id="pm25_status">Partículas finas respiráveis</small>
                        </div>
                        <div class="quality-indicator">
                            <div id="pm25_quality" class="quality-badge">--</div>
                        </div>
                        <div class="chart-mini" style="display: none;">
                            <canvas id="pm25Chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-container">
            <div class="card">
                <div class="card-body">
                    <div class="sensor-data">
                        <div>
                            <h5 class="card-title">PM10</h5>
                            <p class="card-text h4"><span id="pm10">--</span> µg/m³</p>
                            <small class="text-muted" id="pm10_status">Partículas inaláveis</small>
                        </div>
                        <div class="quality-indicator">
                            <div id="pm10_quality" class="quality-badge">--</div>
                        </div>
                        <div class="chart-mini" style="display: none;">
                            <canvas id="pm10Chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-3 mb-4">
        <div class="air-quality-legend">
            <span class="legend-item"><span class="legend-color legend-color-bom"></span> Bom</span>
            <span class="legend-item"><span class="legend-color legend-color-moderado"></span> Moderado</span>
            <span class="legend-item"><span class="legend-color legend-color-ruim"></span> Ruim</span>
            <span class="legend-item"><span class="legend-color legend-color-muito-ruim"></span> Muito Ruim</span>
            <span class="legend-item"><span class="legend-color legend-color-pessimo"></span> Péssimo</span>
        </div>
    </div>

<div class="section-header">
    <h3>Monitoramento de Segurança</h3>
</div>
<p class="section-description">Sensores para detecção de riscos e monitoramento de consumo elétrico</p>
<div class="dashboard-cards">
        <div class="card-container">
            <div class="card">
                <div class="card-body">
                    <div class="sensor-data">
                        <div>
                            <h5 class="card-title">Detecção de Gás</h5>
                            <p class="card-text h4"><span id="gas_detectado">--</span></p>
                            <small class="text-muted">Alerta de vazamento de gás</small>
                        </div>
                        <div class="status-indicator">
                            <div id="gas_indicator" class="indicator"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-container">
            <div class="card">
                <div class="card-body">
                    <div class="sensor-data">
                        <div>
                            <h5 class="card-title">Consumo Elétrico</h5>
                            <p class="card-text h4"><span id="corrente">--</span> mA</p>
                            <small class="text-muted" id="corrente_status">Aguardando leitura...</small>
                        </div>
                        <div class="chart-mini">
                            <canvas id="correnteChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

<div class="section-header">
    <h3>Sensores Meteorológicos Avançados</h3>
</div>
<p class="section-description">Monitoramento de vento, solo, pressão atmosférica e altitude</p>
<div class="dashboard-cards">
        <div class="card-container">
            <div class="card">
                <div class="card-body">
                    <div class="sensor-data">
                        <div>
                            <h5 class="card-title">Velocidade do Vento</h5>
                            <p class="card-text h4"><span id="vento_kmh">--</span> km/h</p>
                            <small class="text-muted"><span id="vento_ms">--</span> m/s</small>
                        </div>
                        <div class="chart-mini">
                            <canvas id="ventoChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-container">
            <div class="card">
                <div class="card-body">
                    <div class="sensor-data">
                        <div>
                            <h5 class="card-title">Umidade do Solo</h5>
                            <p class="card-text h4"><span id="umidade_solo">--</span> %</p>
                            <small class="text-muted">Umidade do solo</small>
                        </div>
                        <div class="chart-mini">
                            <canvas id="soloChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-container">
            <div class="card">
                <div class="card-body">
                    <div class="sensor-data">
                        <div>
                            <h5 class="card-title">Pressão Atmosférica</h5>
                            <p class="card-text h4"><span id="pressao">--</span> hPa</p>
                            <small class="text-muted">BMP280</small>
                        </div>
                        <div class="chart-mini">
                            <canvas id="pressaoChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-container">
            <div class="card">
                <div class="card-body">
                    <div class="sensor-data">
                        <div>
                            <h5 class="card-title">Altitude</h5>
                            <p class="card-text h4"><span id="altitude">--</span> m</p>
                            <small class="text-muted">Acima do nível do mar</small>
                        </div>
                        <div class="chart-mini">
                            <canvas id="altitudeChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="card-container">
            <div class="card">
                <div class="card-body">
                    <div class="sensor-data">
                        <div>
                            <h5 class="card-title">Temperatura BMP280</h5>
                            <p class="card-text h4"><span id="temperatura_bmp">--</span>°C</p>
                            <small class="text-muted">Sensor BMP280</small>
                        </div>
                        <div class="chart-mini">
                            <canvas id="tempBmpChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.7.0/dist/chart.min.js"></script>
<script src="{% static 'sensores/js/utils.js' %}"></script>
<script src="{% static 'sensores/js/modules/charts.js' %}"></script>
<script src="{% static 'sensores/js/modules/indicators.js' %}"></script>
<script src="{% static 'sensores/js/modules/map.js' %}"></script>
<script src="{% static 'sensores/js/modules/websocket.js' %}"></script>
<script src="{% static 'sensores/js/dashboard.js' %}"></script>
{% endblock %}