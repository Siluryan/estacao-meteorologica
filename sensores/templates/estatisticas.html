{% extends 'base.html' %}

{% block title %}Estatísticas dos Sensores{% endblock %}

{% block content %}
<h1>Estatísticas dos Sensores</h1>

<div class="filtro-container">
    <select id="periodo">
        <option value="hoje">Hoje</option>
        <option value="semana">Última Semana</option>
        <option value="mes">Último Mês</option>
    </select>
    <button onclick="filtrarDados()">Filtrar</button>
</div>

<div class="card">
    <h2>Médias - Sensores Principais</h2>
    <table>
        <tr>
            <th>Métrica</th>
            <th>Média</th>
        </tr>
        <tr>
            <td>Temperatura</td>
            <td>{{ media_temperatura }}°C</td>
        </tr>
        <tr>
            <td>Umidade</td>
            <td>{{ media_umidade }}%</td>
        </tr>
        <tr>
            <td>Luminosidade</td>
            <td>{{ media_luminosidade }} lux</td>
        </tr>
        <tr>
            <td>Chuva</td>
            <td>{{ media_chuva }} ({{ media_chuva|floatformat:0 }}% do tempo)</td>
        </tr>
    </table>
</div>

<div class="card">
    <h2>Médias - Sensores de Segurança</h2>
    <table>
        <tr>
            <th>Métrica</th>
            <th>Valor</th>
        </tr>
        <tr>
            <td>Corrente</td>
            <td>{{ media_corrente }} mA</td>
        </tr>
        <tr>
            <td>Detecções de Gás</td>
            <td>{{ deteccoes_gas }} ({{ percentual_gas }}% do tempo)</td>
        </tr>
    </table>
</div>

<div class="card">
    <h2>Médias - Partículas no Ar</h2>
    <table>
        <tr>
            <th>Métrica</th>
            <th>Média</th>
        </tr>
        <tr>
            <td>PM1.0</td>
            <td>{{ media_pm1_0 }} µg/m³</td>
        </tr>
        <tr>
            <td>PM2.5</td>
            <td>{{ media_pm2_5 }} µg/m³</td>
        </tr>
        <tr>
            <td>PM10</td>
            <td>{{ media_pm10 }} µg/m³</td>
        </tr>
    </table>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function filtrarDados() {
        const periodo = document.getElementById('periodo').value;
        window.location.href = `{% url 'estatisticas' %}?periodo=${periodo}`;
    }
</script>
{% endblock %}