{% extends 'base.html' %}

{% block title %}Estatísticas dos Sensores{% endblock %}

{% load static %}
{% block extra_css %}
<link rel="stylesheet" href="{% static 'sensores/css/estatisticas.css' %}">
{% endblock %}

{% block content %}
<div class="page-header">
    <h1><i class="fas fa-chart-bar"></i> Estatísticas dos Sensores</h1>
    <p>Análise histórica e estatísticas detalhadas dos dados coletados</p>
</div>

<div class="filtro-container">
    <select id="periodo">
        <option value="hoje" {% if periodo == 'hoje' %}selected{% endif %}>Hoje</option>
        <option value="semana" {% if periodo == 'semana' %}selected{% endif %}>Últimos 7 dias</option>
        <option value="mes" {% if periodo == 'mes' %}selected{% endif %}>Últimos 30 dias</option>
    </select>
    <button onclick="filtrarDados()">Filtrar</button>
</div>

<div class="tab-container">
    <div class="tab-buttons">
        <button id="tabelas-btn" class="tab-button active" type="button">Tabelas</button>
        <button id="graficos-btn" class="tab-button" type="button">Gráficos</button>
    </div>
    <div id="tabelas" class="tab-content active">
        <div class="stats-container">
            <div class="card">
                <h2>Última Localização Conhecida</h2>
                <table>
                    <tr>
                        <th>Métrica</th>
                        <th>Valor</th>
                    </tr>
                    <tr>
                        <td>Coordenadas</td>
                        <td>{{ ultima_latitude|floatformat:6 }}, {{ ultima_longitude|floatformat:6 }}</td>
                    </tr>
                    <tr>
                        <td>Local</td>
                        <td>{{ ultima_localizacao|default:"Desconhecido" }}</td>
                    </tr>
                </table>
            </div>
            <div class="card">
                <h2>Médias - Ambiente</h2>
                <table>
                    <tr>
                        <th>Métrica</th>
                        <th>Valor</th>
                    </tr>
                    <tr>
                        <td>Temperatura</td>
                        <td>{{ media_temperatura|floatformat:1 }}°C</td>
                    </tr>
                    <tr>
                        <td>Umidade</td>
                        <td>{{ media_umidade|floatformat:1 }}%</td>
                    </tr>
                    <tr>
                        <td>Luminosidade</td>
                        <td>{{ media_luminosidade|floatformat:1 }} lux</td>
                    </tr>
                </table>
            </div>
            <div class="card">
                <h2>Médias - Sensores de Segurança</h2>
                <table>
                    <tr>
                        <th>Métrica</th>
                        <th>Valor</th>
                    </tr>
                    <tr>
                        <td>Gás (MQ-2)</td>
                        <td>{{ percentual_gas|floatformat:1 }}% do tempo</td>
                    </tr>
                    <tr>
                        <td>Corrente Elétrica</td>
                        <td>{{ media_corrente|floatformat:1 }} A</td>
                    </tr>
                </table>
            </div>
            <div class="card">
                <h2>Médias - Qualidade do Ar</h2>
                <table>
                    <tr>
                        <th>Métrica</th>
                        <th>Valor</th>
                    </tr>
                    <tr>
                        <td>Partículas PM1.0</td>
                        <td>{{ media_pm1_0|floatformat:1 }} µg/m³</td>
                    </tr>
                    <tr>
                        <td>Partículas PM2.5</td>
                        <td>{{ media_pm2_5|floatformat:1 }} µg/m³</td>
                    </tr>
                    <tr>
                        <td>Partículas PM10</td>
                        <td>{{ media_pm10|floatformat:1 }} µg/m³</td>
                    </tr>
                </table>
            </div>
            <div class="card">
                <h2>Médias - Sensores Meteorológicos Avançados</h2>
                <table>
                    <tr>
                        <th>Métrica</th>
                        <th>Valor</th>
                    </tr>
                    <tr>
                        <td>Velocidade do Vento</td>
                        <td>{{ media_vento_kmh|floatformat:1 }} km/h</td>
                    </tr>
                    <tr>
                        <td>Umidade do Solo</td>
                        <td>{{ media_umidade_solo|floatformat:1 }}%</td>
                    </tr>
                    <tr>
                        <td>Pressão Atmosférica</td>
                        <td>{{ media_pressao|floatformat:1 }} hPa</td>
                    </tr>
                    <tr>
                        <td>Altitude</td>
                        <td>{{ media_altitude|floatformat:1 }} m</td>
                    </tr>
                    <tr>
                        <td>Temperatura BMP280</td>
                        <td>{{ media_temp_bmp|floatformat:1 }}°C</td>
                    </tr>
                </table>
            </div>
            <div class="card">
                <h2>Extremos - Temperatura</h2>
                <table>
                    <tr>
                        <th>Métrica</th>
                        <th>Valor</th>
                        <th>Data/Hora</th>
                    </tr>
                    <tr>
                        <td>Máxima</td>
                        <td>{{ max_temperatura|default:"--" }}°C</td>
                        <td>{{ max_temperatura_data|default:"--" }}</td>
                    </tr>
                    <tr>
                        <td>Mínima</td>
                        <td>{{ min_temperatura|default:"--" }}°C</td>
                        <td>{{ min_temperatura_data|default:"--" }}</td>
                    </tr>
                </table>
            </div>
            <div class="card">
                <h2>Extremos - Umidade</h2>
                <table>
                    <tr>
                        <th>Métrica</th>
                        <th>Valor</th>
                        <th>Data/Hora</th>
                    </tr>
                    <tr>
                        <td>Máxima</td>
                        <td>{{ max_umidade|default:"--" }}%</td>
                        <td>{{ max_umidade_data|default:"--" }}</td>
                    </tr>
                    <tr>
                        <td>Mínima</td>
                        <td>{{ min_umidade|default:"--" }}%</td>
                        <td>{{ min_umidade_data|default:"--" }}</td>
                    </tr>
                </table>
            </div>
        </div>
    </div>
    <div id="graficos" class="tab-content">
        <div class="stats-container">
            <div class="card">
                <h2>Temperatura</h2>
                <div class="chart-wrapper">
                    <canvas id="temperatureChart"></canvas>
                </div>
            </div>
            <div class="card">
                <h2>Umidade</h2>
                <div class="chart-wrapper">
                    <canvas id="humidityChart"></canvas>
                </div>
            </div>
            <div class="card">
                <h2>Partículas no Ar</h2>
                <div class="chart-wrapper">
                    <canvas id="airParticlesChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    window.dadosTemperatura = {{ dados_temperatura|safe }};
    window.dadosUmidade = {{ dados_umidade|safe }};
    window.dadosParticulas = {{ dados_particulas|safe }};
</script>
<script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
<script src="{% static 'sensores/js/estatisticas.js' %}"></script>
{% endblock %}